<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="to_spreadsheet : Render XLSX from Rails using existing views (html ⇒ xlsx)">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>to_spreadsheet</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/glebm/to_spreadsheet">View on GitHub</a>

          <h1 id="project_title">to_spreadsheet</h1>
          <h2 id="project_tagline">Render XLSX from Rails using existing views (html ⇒ xlsx)</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/glebm/to_spreadsheet/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/glebm/to_spreadsheet/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a id="to_spreadsheet-" class="anchor" href="#to_spreadsheet-" aria-hidden="true"><span class="octicon octicon-link"></span></a>to_spreadsheet <a href="http://travis-ci.org/glebm/to_spreadsheet"><img src="https://secure.travis-ci.org/glebm/to_spreadsheet.png?branch=master" alt="Build Status"></a>
</h1>

<p>to_spreadsheet lets your Rails 3+ app render Excel files using the existing slim/haml/erb/etc views.</p>

<h2>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation</h2>

<p>Add it to your Gemfile:</p>

<div class="highlight highlight-ruby"><pre><span class="pl-k">gem</span> <span class="pl-s"><span class="pl-pds">'</span>to_spreadsheet<span class="pl-pds">'</span></span></pre></div>

<h2>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usage</h2>

<p>In the controller:</p>

<div class="highlight highlight-ruby"><pre><span class="pl-c"># my_thingies_controller.rb</span>
<span class="pl-k">class</span> <span class="pl-en">MyThingiesController<span class="pl-e"> &lt; ApplicationController</span></span>
  respond_to <span class="pl-c1">:xls</span>, <span class="pl-c1">:html</span>
  <span class="pl-k">def</span> <span class="pl-en">index</span>
    <span class="pl-smi">@my_items</span> <span class="pl-k">=</span> <span class="pl-c1">MyItem</span>.all
    respond_to <span class="pl-k">do </span>|<span class="pl-smi">format</span>|
      format.html 
      format.xlsx { render <span class="pl-c1">xlsx:</span> <span class="pl-c1">:index</span>, <span class="pl-c1">filename:</span> <span class="pl-s"><span class="pl-pds">"</span>my_items_doc<span class="pl-pds">"</span></span> }
    <span class="pl-k">end</span>
  <span class="pl-k">end</span>
<span class="pl-k">end</span></pre></div>

<p>In the view partial:</p>

<div class="highlight highlight-haml"><pre># _my_items.haml
%<span class="pl-ent">table</span>
  %<span class="pl-ent">caption</span> My items
  %<span class="pl-ent">thead</span>
    %<span class="pl-ent">tr</span>
      %<span class="pl-ent">td</span> ID
      %<span class="pl-ent">td</span> Name
  %<span class="pl-ent">tbody</span>
    -<span class="pl-sre"> my_items.each </span><span class="pl-sre"><span class="pl-k">do</span> |my_item|</span>
      %<span class="pl-ent">tr</span>
        %<span class="pl-ent">td</span><span class="pl-ent">.number</span>=<span class="pl-sre"> my_item.id</span>
        %<span class="pl-ent">td</span>=<span class="pl-sre"> my_item.name</span>
  %<span class="pl-ent">tfoot</span>
    %<span class="pl-ent">tr</span>
      %<span class="pl-ent">td</span>(colspan="2") #{my_items.length}</pre></div>

<p>In the XLSX view:</p>

<div class="highlight highlight-haml"><pre># index.xls.haml
=<span class="pl-sre"> render 'my_items', my_items: @my_items</span></pre></div>

<p>In the HTML view:</p>

<div class="highlight highlight-haml"><pre># index.html.haml
=<span class="pl-sre"> link_to 'Download spreadsheet', my_items_url(format: :xlsx)</span>
=<span class="pl-sre"> render 'my_items', my_items: @my_items</span></pre></div>

<h3>
<a id="worksheets" class="anchor" href="#worksheets" aria-hidden="true"><span class="octicon octicon-link"></span></a>Worksheets</h3>

<p>Every table in the view will be converted to a separate sheet.
The sheet title will be assigned to the value of the table’s caption element if it exists.</p>

<h3>
<a id="formatting" class="anchor" href="#formatting" aria-hidden="true"><span class="octicon octicon-link"></span></a>Formatting</h3>

<p>You can define formats in your view file (local to the view) or in the initializer</p>

<div class="highlight highlight-ruby"><pre>format_xls <span class="pl-s"><span class="pl-pds">'</span>table.my-table<span class="pl-pds">'</span></span> <span class="pl-k">do</span>
  workbook <span class="pl-c1">use_autowidth:</span> <span class="pl-c1">true</span>
  sheet    <span class="pl-c1">orientation:</span> landscape
  format <span class="pl-s"><span class="pl-pds">'</span>th<span class="pl-pds">'</span></span>, <span class="pl-c1">b:</span> <span class="pl-c1">true</span> <span class="pl-c"># bold</span>
  format <span class="pl-s"><span class="pl-pds">'</span>tbody tr<span class="pl-pds">'</span></span>, <span class="pl-c1">bg_color:</span> lambda { |<span class="pl-smi">row</span>| <span class="pl-s"><span class="pl-pds">'</span>ddffdd<span class="pl-pds">'</span></span> <span class="pl-k">if</span> row.index.odd? }
  format <span class="pl-s"><span class="pl-pds">'</span>A3:B10<span class="pl-pds">'</span></span>, <span class="pl-c1">i:</span> <span class="pl-c1">true</span> <span class="pl-c"># italic</span>
  format <span class="pl-c1">column:</span> <span class="pl-c1">0</span>, <span class="pl-c1">width:</span> <span class="pl-c1">35</span>
  format <span class="pl-s"><span class="pl-pds">'</span>td.custom<span class="pl-pds">'</span></span>, lambda { |<span class="pl-smi">cell</span>| modify cell somehow.}
  <span class="pl-c"># default value (fallback value when value is blank or 0 for integer / float)</span>
  default <span class="pl-s"><span class="pl-pds">'</span>td.price<span class="pl-pds">'</span></span>, <span class="pl-c1">10</span>
<span class="pl-k">end</span></pre></div>

<p>For the full list of supported properties head here: <a href="http://rubydoc.info/github/randym/axlsx/Axlsx/Styles#add_style-instance_method">http://rubydoc.info/github/randym/axlsx/Axlsx/Styles#add_style-instance_method</a>
In addition, for column formats, Axlsx columnInfo properties are also supported</p>

<h3>
<a id="advanced-formatting" class="anchor" href="#advanced-formatting" aria-hidden="true"><span class="octicon octicon-link"></span></a>Advanced formatting</h3>

<p>to_spreadsheet <a href="https://github.com/glebm/to_spreadsheet/blob/master/lib/to_spreadsheet/renderer.rb#L33">associates</a> HTML nodes with Axlsx objects as follows:</p>

<table>
<thead>
<tr>
<th>HTML tag</th>
<th>Axlsx object</th>
</tr>
</thead>
<tbody>
<tr>
<td>table</td>
<td>worksheet</td>
</tr>
<tr>
<td>tr</td>
<td>row</td>
</tr>
<tr>
<td>td, th</td>
<td>cell</td>
</tr>
</tbody>
</table>

<p>For example, to directly manipulate a worksheet:</p>

<div class="highlight highlight-ruby"><pre>format_xls <span class="pl-k">do</span>
  format <span class="pl-s"><span class="pl-pds">'</span>table<span class="pl-pds">'</span></span> <span class="pl-k">do </span>|<span class="pl-smi">worksheet</span>|
    worksheet.add_chart ...
    <span class="pl-c"># to get the associated Nokogiri node:</span>
    el <span class="pl-k">=</span> context.to_xml_node(worksheet)
  <span class="pl-k">end</span>
<span class="pl-k">end</span></pre></div>

<h3>
<a id="themes" class="anchor" href="#themes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Themes</h3>

<p>You can define themes, i.e. blocks of formatting code:</p>

<div class="highlight highlight-ruby"><pre><span class="pl-c1">ToSpreadsheet</span>.theme <span class="pl-c1">:zebra</span> <span class="pl-k">do</span>
  format <span class="pl-s"><span class="pl-pds">'</span>tr<span class="pl-pds">'</span></span>, <span class="pl-c1">bg_color:</span> lambda { |<span class="pl-smi">row</span>| <span class="pl-s"><span class="pl-pds">'</span>ddffdd<span class="pl-pds">'</span></span> <span class="pl-k">if</span> row.index.odd? }
<span class="pl-k">end</span></pre></div>

<p>And then use them:</p>

<div class="highlight highlight-ruby"><pre>format_xls <span class="pl-s"><span class="pl-pds">'</span>table.zebra<span class="pl-pds">'</span></span>, <span class="pl-c1">ToSpreadsheet</span>.theme(<span class="pl-c1">:zebra</span>)</pre></div>

<h3>
<a id="types" class="anchor" href="#types" aria-hidden="true"><span class="octicon octicon-link"></span></a>Types</h3>

<p>The default theme uses class names on td/th to cast values.
Here is the list of class to type mapping:</p>

<table>
<thead>
<tr>
<th>CSS class</th>
<th>Format</th>
</tr>
</thead>
<tbody>
<tr>
<td>decimal or float</td>
<td>Decimal</td>
</tr>
<tr>
<td>num or int</td>
<td>Integer</td>
</tr>
<tr>
<td>datetime</td>
<td>DateTime (Chronic.parse)</td>
</tr>
<tr>
<td>date</td>
<td>Date (Date.parse)</td>
</tr>
<tr>
<td>time</td>
<td>Time (Chronic.parse)</td>
</tr>
</tbody>
</table>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">to_spreadsheet maintained by <a href="https://github.com/glebm">glebm</a></p>
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-65961090-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>


  </body>
</html>
